
![](../_resources/Pasted%20image%2020241204220114.png)

![](../_resources/Pasted%20image%2020241204220128.png)
![](../_resources/Pasted%20image%2020241204220139.png)

![](../_resources/Pasted%20image%2020241204220207.png)
- Что может подразумеваться под файловой системой?
	- сам набор файлов/папок
	- метод организации данных
		- нейминг
		- иерархия, формат хранения
		- методы доступа и тд
	- партиции диска


![](../_resources/Pasted%20image%2020241204220613.png)
![](../_resources/Pasted%20image%2020241204220553.png)

> С файловой системой взаимодействует именно ядро


#### Задачи файловой системы
- Система наименования
	- KV вида: Key - path, Value - file
- Формат хранения
- Интерфейс для взаимодействия с ФС
	- чтение
	- запись
	- разные режимы и проч
> Кастомная реализация ФС на СИ - это структура, инициализированная указателями на функции - то есть предоставляющая имплементацию API. Ядро вызывает разные имплементации в унифицированном виде, оно не знает про конкретные реализации ФС

 - Механизмы защиты, права доступа, принадлежность файлов и тд


![](../_resources/Pasted%20image%2020241204221710.png)

> Файловая система - это абстракция над физическими локальными/удаленным хранилищами данных, которые на аппаратном уровне представляют не что иное как массив байт. Файловая система - это по сути метод разметки этих байт, метод организации доступа к ним.

![](../_resources/Pasted%20image%2020241204223759.png)
- Причем можем монтировать разные файловые системы к разным видам хранилищ - tmpfs адаптирована для работы поверх ram, однако мы можем примонтировать ее к hdd/ssd

> ***proc*** - виртуальная файловая система, которая по сути является набором хендлеров в ядре, которые обрабатывают операции для работы с файловой системой. просто в userspace доступ к этому набору осуществляется через FS API

![](../_resources/Pasted%20image%2020241204224032.png)


![](../_resources/Pasted%20image%2020241204234448.png)
- Последовательный доступ
	- только запись(клавиатура - символы), только чтение(монитор - последовательность фреймов)
	- и эти <>-only операции производятся one-by-one
	- нет возможности обратиться к произвольному блоку данных на произвольном оффсете произвольного размера
	- в этом смысле сетевая карта - тоже sequential access устройство


#### Устройство HDD

![](../_resources/Pasted%20image%2020241205000725.png)
- Ядро посылает команды на контроллер: считать такие то байты, записать такие-то байты и тп, посылает посредством вызова функций драйвера
- Контроллер уже управляет считывающей головкой, байты считываются с секторов вращающихся дисков 


1. **Приложение** обращается к файловой системе для чтения/записи данных.
2. **Файловая система** переводит запросы приложения в низкоуровневые операции ввода-вывода (например, чтение определенного блока данных).
3. **Ядро ОС** получает эти запросы и передает их соответствующему **драйверу устройства**, который отвечает за взаимодействие с конкретным оборудованием (в данном случае – HDD). Драйвер загружается в память ядра во время запуска системы.
4. **Драйвер** преобразует запрос от ядра в набор команд, которые понимает контроллер HDD.
5. **Контроллер HDD** получает команду от драйвера и выполняет необходимые действия: перемещает считывающие головки, читает или записывает данные на магнитные пластины диска.
6. После выполнения операций контроллер возвращает результат обратно драйверу, а тот – ядру ОС, которое затем обрабатывает его и передает приложению.

Таким образом, вся работа происходит через драйвер, который является "посредником" между программной частью (ядром ОС) и аппаратурой (контроллером HDD).





![](../_resources/Pasted%20image%2020241205004202.png)


![](../_resources/Pasted%20image%2020241205004223.png)
- MBR - содержит мета информацию о корневых партициях устройства хранения, которые могут разбиваться на подпартиции


![](../_resources/Pasted%20image%2020241205004819.png)
- В конечном счете каждая конечная партиция ассоциируется с той или иной файловой системой, коих не так уж и много - у каждой fs есть ""магическое число" - идентификатор
- Этот идентификатор и другая метадата хранится в заголовке файловой системы, который находится в начала партиции