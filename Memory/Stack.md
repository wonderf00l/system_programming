  
![[Pasted image 20241230120740.png]]

  
  
  

- Куча - тоже область памяти, в ней данные расположены в порядке увеличения адресов памяти 
![[Pasted image 20241230120812.png]]

  

- В стеке - наоборот: данные добавляются в порядке уменьшения адресов, то есть стек растет от старшего адреса памяти к младшему
    

![[Pasted image 20241230120834.png]]


- Каждый элемент стека занимает одно машинное слово, то есть размер стека - это размер машинного слова    
- Для работы со стеком понадобятся указатели на его элементы:
- SP(stack pointer) - указатель вершины стека - адрес last добавленного элемента - хранится в регистре stack pointer
- Второй указатель хранится в регистре BP - адрес начала стека
    
![[Pasted image 20241230120907.png]]

- При команде push SP уменьшится на одно машинное слово(n байт), новый адрес будет указывать на свободную верхнюю ячейку - далее в ячейку запишется 3    
- Pop ax - взять значение, на которое указывает SP, положить значение в регистр ax, увеличить значение указателя SP на 1 машинное слово - в данном случае для примера 2 байта


![[Pasted image 20241230133713.png]]
- Процессор исполняет инструкции одну за другой, переходит по адресу след инструкции и тд...
	- адрес след инструкции берет из реистра ***IP***

#### Инструкции jump, call, ret
- jump {inst addr} - переход к instr addr
- call {inst addr} - формирование адреса возврата(адреса инструкции после call) + переход по inst addr - вызывается перед вызовом функции, внутри ***вызывающей функции***
- ret - извлечение адреса возврата, переход по адресу возврата - исполняется в ***вызываемой функции***
![[Pasted image 20241230133730.png]]

#### Пролог/эпилог функции
- Данные функции(локальные переменные) хранятся в стек-фрейме
- Формирование и удаление стек-фреймов происходит в ***прологе/эпилоге функции***
- исполнение ***call*** - вызов подфункции
	- сохранение адреса возврата
	- переход к инструкциям подфункции
- Пролог - инструкции в самом начале функции
	- ***push bp*** - сохранить значение bp стек-фрейма предыдущей функции(сохраняем старое значение bp - старый адрес) - для восстановления состояния после возврата из вызываемой функции
	- ***mov bp, sp*** -  записать в bp текущее значение sp
- Эпилог
	- ***mov sp, bp*** -  записать в sp текущее значение bp
	- ***pop bp*** -  снять старое значение bp, записать в bp старое значение bp
	- выполнить ret - извлечь адрес возврата со стека(записанный при исполнении call), перейти нему
![[Pasted image 20241230133800.png]]
![[Pasted image 20241230134429.png]]

#### Передача аргументов
![[Pasted image 20241230133856.png]]
- Передавать значения аргументов можно через:
	- регистры - наиболее быстрый доступ, но их число ограничено
	- стек - поход в озу, будет использовать при большом числе аругментов

![[Pasted image 20241230133837.png]]
- При передаче аргументов через стек:
	- их значения кладутся на вершину стека
	- далее исполняется call
	- сохранение адреса возврата, значения bp
	- адреса аргументов со значениями в стеке кладуется в регистры(а если аргументов много??)
##### удаление использованных аргументов 
![[Pasted image 20241230133845.png]]
- вызываемая функция
	- при исполнении ret из стека удаляется sizeof(args) байт, sp встает на положенное место,   

#### Хранение локальных переменных